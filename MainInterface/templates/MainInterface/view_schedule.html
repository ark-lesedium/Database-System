{% extends 'MainInterface/base.html' %}

{% block title %}Class Schedule - Database System{% endblock %}
{% block header %}Class Schedule{% endblock %}
{% block nav_buttons %}
    {% if user.userprofile.user_type == 'lecturer' %}
        <a href="{% url 'manage_schedule' %}" class="nav-btn" style="background-color: #28a745;">Manage Schedule</a>
        <a href="{% url 'lecturer_dashboard' %}" class="nav-btn">Back to Dashboard</a>
    {% else %}
        <a href="{% url 'student_dashboard' %}" class="nav-btn">Back to Dashboard</a>
    {% endif %}
{% endblock %}

{% block content %}
<style>
    .schedule-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .calendar-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .nav-button {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        text-decoration: none;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    .nav-button:hover {
        background-color: #0056b3;
        color: white;
        text-decoration: none;
    }
    
    .calendar-title {
        font-size: 24px;
        font-weight: bold;
        color: #333;
        margin: 0;
    }
    
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: #ddd;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 30px;
    }
    
    .calendar-header {
        background: #007bff;
        color: white;
        padding: 15px 10px;
        text-align: center;
        font-weight: bold;
    }
    
    .calendar-day {
        background: white;
        min-height: 120px;
        padding: 8px;
        position: relative;
        border: 1px solid #eee;
    }
    
    .calendar-day.other-month {
        background: #f8f9fa;
        color: #999;
    }
    
    .calendar-day.today {
        background: #e3f2fd;
        border: 2px solid #2196f3;
    }
    
    .day-number {
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .schedule-event {
        background: #28a745;
        color: white;
        font-size: 11px;
        padding: 2px 4px;
        margin: 1px 0;
        border-radius: 3px;
        cursor: pointer;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .schedule-event.lecture {
        background: #28a745;
    }
    
    .schedule-event.lab {
        background: #dc3545;
    }
    
    .schedule-event.tutorial {
        background: #ffc107;
        color: #333;
    }
    
    .schedule-event.exam {
        background: #6f42c1;
    }
    
    .schedule-event.online {
        background: #17a2b8;
    }
    
    .schedule-event:hover {
        opacity: 0.8;
    }
    
    .upcoming-section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    
    .upcoming-title {
        font-size: 20px;
        font-weight: bold;
        color: #333;
        margin-bottom: 15px;
        border-bottom: 2px solid #007bff;
        padding-bottom: 5px;
    }
    
    .upcoming-event {
        border-left: 4px solid #28a745;
        background: #f8f9fa;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 4px;
    }
    
    .upcoming-event.lab {
        border-left-color: #dc3545;
    }
    
    .upcoming-event.tutorial {
        border-left-color: #ffc107;
    }
    
    .upcoming-event.exam {
        border-left-color: #6f42c1;
    }
    
    .upcoming-event.online {
        border-left-color: #17a2b8;
    }
    
    .event-title {
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
    }
    
    .event-details {
        color: #666;
        font-size: 14px;
    }
    
    .event-time {
        color: #007bff;
        font-weight: bold;
    }
    
    .no-events {
        text-align: center;
        color: #999;
        font-style: italic;
        padding: 40px 20px;
    }
    
    .legend {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        font-size: 14px;
    }
    
    .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 3px;
        margin-right: 8px;
    }
</style>

<div class="schedule-container">
    <!-- Calendar Navigation -->
    <div class="calendar-navigation">
        <a href="?year={{ prev_year }}&month={{ prev_month }}" class="nav-button">
            ← Previous
        </a>
        <h2 class="calendar-title">{{ month_name }} {{ year }}</h2>
        <a href="?year={{ next_year }}&month={{ next_month }}" class="nav-button">
            Next →
        </a>
    </div>
    
    <!-- Legend -->
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: #28a745;"></div>
            <span>Lecture</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #dc3545;"></div>
            <span>Laboratory</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #ffc107;"></div>
            <span>Tutorial</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #6f42c1;"></div>
            <span>Exam</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #17a2b8;"></div>
            <span>Online</span>
        </div>
    </div>
    
    <!-- Calendar Grid -->
    <div class="calendar-grid">
        <!-- Calendar Headers -->
        <div class="calendar-header">Sunday</div>
        <div class="calendar-header">Monday</div>
        <div class="calendar-header">Tuesday</div>
        <div class="calendar-header">Wednesday</div>
        <div class="calendar-header">Thursday</div>
        <div class="calendar-header">Friday</div>
        <div class="calendar-header">Saturday</div>
        
        <!-- Calendar Days -->
        {% for week in calendar %}
            {% for day in week %}
                <div class="calendar-day {% if day == today.day and month == today.month and year == today.year %}today{% endif %}">
                    {% if day == 0 %}
                        <div class="day-number other-month"></div>
                    {% else %}
                        <div class="day-number">{{ day }}</div>
                        {% for schedule in all_schedules %}
                            {% if schedule.start_datetime.day == day %}
                                <div class="schedule-event {{ schedule.class_type }}" 
                                     title="{{ schedule.title }} - {{ schedule.course.course_code }} ({{ schedule.start_datetime|time:'H:i' }}-{{ schedule.end_datetime|time:'H:i' }})">
                                    {{ schedule.start_datetime|time:'H:i' }} {{ schedule.course.course_code }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                </div>
            {% endfor %}
        {% endfor %}
    </div>
    
    <!-- Upcoming Events Section -->
    <div class="upcoming-section">
        <h3 class="upcoming-title">Upcoming Events (Next 7 Days)</h3>
        {% if upcoming_schedules %}
            {% for schedule in upcoming_schedules %}
                <div class="upcoming-event {{ schedule.class_type }}">
                    <div class="event-title">
                        {{ schedule.title }} - {{ schedule.course.course_code }}
                        {% if schedule.is_cancelled %}
                            <span style="color: #dc3545; font-weight: bold;">(CANCELLED)</span>
                        {% endif %}
                    </div>
                    <div class="event-details">
                        <span class="event-time">
                            {{ schedule.start_datetime|date:'l, F j' }} at {{ schedule.start_datetime|time:'g:i A' }} - {{ schedule.end_datetime|time:'g:i A' }}
                        </span>
                        {% if schedule.location %}
                            | Location: {{ schedule.location }}
                        {% endif %}
                        {% if schedule.is_online %}
                            | Online Session
                        {% endif %}
                    </div>
                    {% if schedule.description %}
                        <div class="event-details" style="margin-top: 5px;">
                            {{ schedule.description }}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <div class="no-events">
                No upcoming events in the next 7 days.
            </div>
        {% endif %}
    </div>
    
    <!-- Back to Dashboard -->
    <div style="text-align: center; margin-top: 30px;">
        {% if user.userprofile.user_type == 'student' %}
            <a href="{% url 'student_dashboard' %}" class="nav-button">
                ← Back to Dashboard
            </a>
        {% elif user.userprofile.user_type == 'lecturer' %}
            <a href="{% url 'lecturer_dashboard' %}" class="nav-button">
                ← Back to Dashboard
            </a>
        {% else %}
            <a href="{% url 'dashboard' %}" class="nav-button">
                ← Back to Dashboard
            </a>
        {% endif %}
    </div>
</div>

{% endblock %}
